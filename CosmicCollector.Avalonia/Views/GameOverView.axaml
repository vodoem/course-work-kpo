<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:dg="clr-namespace:Avalonia.Controls;assembly=Avalonia.Controls.DataGrid"
             x:Class="CosmicCollector.Avalonia.Views.GameOverView">
  <UserControl.KeyBindings>
    <KeyBinding Gesture="Escape" Command="{Binding BackToMenuCommand}" />
    <KeyBinding Gesture="R" Command="{Binding RestartCommand}" />
    <KeyBinding Gesture="Enter" Command="{Binding PrimaryActionCommand}" />
  </UserControl.KeyBindings>
  <UserControl.Styles>
    <Style Selector="TextBlock">
      <Setter Property="Foreground" Value="White" />
    </Style>
    <Style Selector="dg|DataGrid">
      <Setter Property="Foreground" Value="Black" />
      <Setter Property="Background" Value="#E6E6E6" />
      <Setter Property="BorderBrush" Value="#BDBDBD" />
      <Setter Property="BorderThickness" Value="1" />
    </Style>
    <Style Selector="dg|DataGridColumnHeader">
      <Setter Property="Background" Value="#2A2A2A" />
      <Setter Property="Foreground" Value="White" />
    </Style>
    <Style Selector="dg|DataGridCell">
      <Setter Property="Foreground" Value="Black" />
    </Style>
    <Style Selector="dg|DataGridCell > TextBlock">
      <Setter Property="Foreground" Value="Black" />
    </Style>
    <Style Selector="TextBox">
      <Setter Property="Foreground" Value="White" />
      <Setter Property="Background" Value="#2A2A2A" />
      <Setter Property="BorderBrush" Value="#4A4A4A" />
      <Setter Property="BorderThickness" Value="1" />
    </Style>
  </UserControl.Styles>
  <Grid Background="#0F0F0F"
        RowDefinitions="Auto,Auto,*">
    <StackPanel Margin="24,16,24,0"
                Spacing="4">
      <TextBlock Text="РЕКОРДЫ"
                 FontSize="26"
                 FontWeight="Bold" />
      <TextBlock Text="Поражение."
                 FontSize="14"
                 Opacity="0.8" />
    </StackPanel>
    <Border Grid.Row="1"
            Margin="24,12,24,0"
            Background="#1C1C1C"
            CornerRadius="16"
            Padding="16">
      <Grid ColumnDefinitions="*,*,*,*">
        <StackPanel>
          <TextBlock Text="Уровень" FontWeight="Bold" />
          <TextBlock Text="{Binding Level}" />
        </StackPanel>
        <StackPanel Grid.Column="1">
          <TextBlock Text="Очки" FontWeight="Bold" />
          <TextBlock Text="{Binding Score}" />
        </StackPanel>
        <StackPanel Grid.Column="2">
          <TextBlock Text="Энергия" FontWeight="Bold" />
          <TextBlock Text="{Binding Energy}" />
        </StackPanel>
        <StackPanel Grid.Column="3">
          <TextBlock Text="Время" FontWeight="Bold" />
          <TextBlock Text="{Binding TimerText}" />
        </StackPanel>
      </Grid>
    </Border>
    <Grid Grid.Row="2"
          Margin="24"
          RowDefinitions="Auto,Auto,*,Auto"
          Background="#0F0F0F">
      <Border Background="#1C1C1C"
              CornerRadius="16"
              Padding="24"
              Margin="0,0,0,16">
        <StackPanel Spacing="12">
          <TextBlock Text="Ваш рекорд"
                     FontSize="18"
                     FontWeight="Bold" />
          <TextBlock Text="{Binding Score}"
                     FontSize="32"
                     FontWeight="Bold" />
          <StackPanel IsVisible="{Binding IsInputModeVisible}"
                      Spacing="8">
            <TextBlock Text="Новый рекорд!" />
            <TextBlock Text="Введите имя (1–16):" />
            <TextBox Text="{Binding PlayerName}"
                     MaxLength="16"
                     FontSize="16" />
            <TextBlock Text="{Binding NameError}"
                       IsVisible="{Binding HasNameError}"
                       Foreground="#FF6B6B"
                       FontSize="12" />
            <Button Content="Сохранить"
                    Command="{Binding SaveRecordCommand}" />
          </StackPanel>
        </StackPanel>
      </Border>
      <Border Grid.Row="2"
              Background="#1C1C1C"
              CornerRadius="16"
              Padding="16"
              IsVisible="{Binding IsTableModeVisible}">
        <Grid RowDefinitions="Auto,*">
          <TextBlock Text="Топ-10"
                     FontSize="16"
                     FontWeight="Bold"
                     Margin="0,0,0,8" />
          <dg:DataGrid Grid.Row="1"
                       AutoGenerateColumns="False"
                       HeadersVisibility="Column"
                       IsReadOnly="True"
                       ItemsSource="{Binding TopRecords}"
                       GridLinesVisibility="Horizontal">
            <dg:DataGrid.Columns>
              <dg:DataGridTextColumn Header="Место" Binding="{Binding Position}" Width="Auto" />
              <dg:DataGridTextColumn Header="Имя" Binding="{Binding PlayerName}" Width="*" />
              <dg:DataGridTextColumn Header="Уровень" Binding="{Binding Level}" Width="Auto" />
              <dg:DataGridTextColumn Header="Очки" Binding="{Binding Score}" Width="Auto" />
              <dg:DataGridTextColumn Header="Дата (UTC)" Binding="{Binding Time}" Width="Auto" />
            </dg:DataGrid.Columns>
          </dg:DataGrid>
          <TextBlock Grid.Row="1"
                     IsVisible="{Binding NoRecords}"
                     Text="Записей нет."
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center" />
        </Grid>
      </Border>
      <StackPanel Grid.Row="3"
                  Orientation="Horizontal"
                  HorizontalAlignment="Center"
                  Spacing="16"
                  Margin="0,8,0,0">
        <Button Content="Главное меню"
                Command="{Binding BackToMenuCommand}" />
        <Button Content="Заново"
                Command="{Binding RestartCommand}" />
      </StackPanel>
      <TextBlock Grid.Row="3"
                 HorizontalAlignment="Right"
                 VerticalAlignment="Center"
                 Text="Enter — сохранить/меню, Esc — меню, R — заново"
                 FontSize="12"
                 Opacity="0.7" />
    </Grid>
  </Grid>
</UserControl>
